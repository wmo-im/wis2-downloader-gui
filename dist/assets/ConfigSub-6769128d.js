import{_ as he,Q as Pe,R as f,X as T,k as e,T as o,G as N,V as r,r as s,c as Q,U as Le,O as X,a2 as Ie,J as i,$ as U,Z as S,Y,W as y,M as B,a3 as de,S as k,a4 as $e,a5 as Ee}from"./index-d1750036.js";import{m as Ne,b as g,c as p,d as b,e as P,f as V,g as fe,h as Ue,V as Z,i as W,n as ge,o as H,a as We,j as c,k as D,p as ue,l as h,q as ce}from"./VRow-aeba6419.js";const Fe=Ne("v-spacer","div","VSpacer");const je=Pe({name:"ConfigSub",components:{VCard:p,VCardTitle:b,VCardText:P,VCardItem:V,VForm:fe,VBtn:r,VListGroup:Ue,VSelect:Z,VTextField:W,VChipGroup:ge,VChip:H,VCheckboxBtn:We},setup(){const l=s(!1),a=s(!1),F=s([]),L=s(!1),m=s(""),A=s(""),t=s([]),u=s(""),v=s(!1),w=s(""),j=s(null),I=s(null),$=s([]),R=s(!1),_=s(""),G=s(""),K=s(""),O=s(!1),ve=s(!1),x=s(!1),pe=s(""),q=s(!1),ee=s(""),oe=Q(()=>m.value!==""),me=Q(()=>oe.value&&t.value.length>0&&u.value!==""),we=Q(()=>u.value.length>30?"..."+u.value.slice(-30):u.value),be=async()=>{try{const n=await window.electronAPI.loadSettings();n&&(m.value=n.broker,t.value=n.topics,u.value=n.downloadDirectory,v.value=n.subscribeStatus)}catch(n){console.error("Error loading settings: ",n)}},le=async()=>{try{const n=await window.electronAPI.loadConfigNames();$.value=n}catch(n){console.error("Error loading config list: ",n)}},ke=n=>{K.value=n,O.value=!0},Ce=async()=>{try{a.value=!0,await window.electronAPI.deleteConfig(K.value),setTimeout(()=>{le(),O.value=!1,a.value=!1},1e3)}catch(n){console.error("Error deleting configurations: ",n)}},z=async()=>{try{const n=await window.electronAPI.loadBrokers();F.value=n}catch(n){console.error("Error loading brokers: ",n)}},ye=async()=>{try{L.value=!0;const d=await fetch("https://api.weather.gc.ca/collections/wis2-discovery-metadata/items");if(!d.ok)throw new Error("Failed to query catalogue");const se=(await d.json()).features[0];if(se){const re=[];let M="",J="";se.links.forEach(C=>{C.rel==="items"&&C.href.startsWith("mqtt")&&C.channel.startsWith("cache")&&(M=C.href.split("@")[1].split(":")[0],C.title?J=C.title.split("Notifications from ")[1]:J=M,re.push({title:J,url:M}))}),window.electronAPI.writeBrokers(re)}setTimeout(()=>{z(),L.value=!1},1e3)}catch(n){console.error("Error syncing brokers: ",n)}},De=()=>{A.value.trim()!==""&&(t.value.push(A.value),A.value="")},Ve=n=>{t.value.splice(n,1)},Ae=async n=>{try{const d=await window.electronAPI.openDialog();d&&(n=="download"?u.value=d:n=="save"&&(G.value=d,ae(),R.value=!1))}catch(d){console.error("Error selecting directory:",d)}},ae=()=>{try{const n={name:_.value,directory:G.value},d={brokerURL:m.value,topicsList:Array.from(t.value),downloadDirectory:u.value};window.electronAPI.saveConfig(n,d),$.value.includes(n.name)||$.value.push(n.name),R.value=!1}catch(n){console.error("Error saving config: ",n)}},Te=()=>{v.value=!v.value;try{const n={broker:m.value,topics:Array.from(t.value),downloadDirectory:u.value,shouldSubscribe:v.value};console.log("Data sent to backend: ",n),window.electronAPI.handleSubscription(n)}catch(n){console.error("Error subscribing: ",n),w.value="Error occurred with backend subscriber"}},te=(n,d)=>{console.log("Backend response:",d),w.value+=`
`+d.status+`
`},ne=(n,d)=>{w.value+=`
`+d+`
`},ie=(n,d)=>{w.value+=`
`+d+`
`},Se=n=>{ee.value=n,q.value=!0},Be=async(n,d)=>{if(d==="add"){t.value.push(n);const E={topic:n,action:"add"};await window.electronAPI.manageTopics(E),x.value=!1}else if(d==="delete"){a.value=!0,t.value.splice(t.value.indexOf(n),1);const E={topic:n,action:"delete"};await window.electronAPI.manageTopics(E),q.value=!1,a.value=!1}};return Le(()=>{be(),le(),z(),window.electronAPI.onSubscriptionResponse(te),window.electronAPI.onBackendStdout(ne),window.electronAPI.onBackendStderr(ie)}),X(I,async()=>{if(I.value){const n=await window.electronAPI.loadConfig(I.value);console.log("Config data obtained: ",n),m.value=n.brokerURL,t.value=n.topicsList,u.value=n.downloadDirectory}}),X([m,t,u,v],()=>{const n={broker:m.value,topics:Array.from(t.value),downloadDirectory:u.value,subscribeStatus:v.value};console.log("Storing settings:",n),window.electronAPI.storeSettings(n)},{deep:!0}),X(w,()=>{Ee(()=>{j.value&&j.value.scrollIntoView(),w.value=w.value.trim()})}),Ie(()=>{window.electronAPI.removeListener("subscription-response",te),window.electronAPI.removeListener("backend-stdout",ne),window.electronAPI.removeListener("backend-stderr",ie)}),{brokerList:F,syncLoadingBoolean:L,selectedBroker:m,topicEntry:A,topicsList:t,downloadDirectory:u,isBrokerSelected:oe,canSubscribe:me,truncatedDirectory:we,addTopic:De,removeTopic:Ve,selectDirectory:Ae,subscribePressed:v,backendOutput:w,latestResponse:j,toggleSubscription:Te,selectedConfig:I,configList:$,configDialog:l,showSaveDialog:R,saveConfiguration:ae,configName:_,configDirectory:G,loadBrokers:z,syncBrokers:ye,configToDelete:K,deleteConfig:Ce,showConfigWarningDialog:O,confirmConfigDelete:ke,deleteLoadingBoolean:a,showTopicDialog:ve,showAddTopicDialog:x,topicToAdd:pe,manageTopics:Be,showTopicWarningDialog:q,topicToDelete:ee,confirmTopicDelete:Se}}}),Re={key:0},Ge={class:"d-flex justify-center"},Ke={class:"d-flex justify-center"},Oe={class:"d-flex justify-center"},qe={ref:"latestResponse"};function ze(l,a,F,L,m,A){return f(),T(N,null,[e(g,{class:"justify-center"},{default:o(()=>[e(c,{cols:"12",class:"max-form-width"},{default:o(()=>[e(p,null,{default:o(()=>[e(g,{dense:""},{default:o(()=>[e(c,{cols:"auto"},{default:o(()=>[e(b,{class:"big-title"},{default:o(()=>[i("WIS2 Subscription Configuration")]),_:1})]),_:1}),e(Fe),e(c,{cols:"4"},{default:o(()=>[e(Z,{label:"Configurations",density:"comfortable",variant:"solo-filled",class:"mx-3",items:l.configList,modelValue:l.selectedConfig,"onUpdate:modelValue":a[0]||(a[0]=t=>l.selectedConfig=t)},null,8,["items","modelValue"])]),_:1}),e(c,{cols:"1"},{default:o(()=>[e(r,{color:"#003DA5",variant:"flat",icon:"mdi-delete",class:"mx-1",onClick:a[1]||(a[1]=t=>l.configDialog=!0)})]),_:1})]),_:1}),e(D,{modelValue:l.configDialog,"onUpdate:modelValue":a[3]||(a[3]=t=>l.configDialog=t),"max-width":"300px"},{default:o(()=>[e(p,null,{default:o(()=>[e(U,{title:"Delete Configurations",color:"#003DA5"},{default:o(()=>[e(r,{icon:"mdi-close",variant:"text",onClick:a[2]||(a[2]=t=>l.configDialog=!1)})]),_:1}),e(P,null,{default:o(()=>[l.configList.length===0?(f(),T("div",Re,"No configurations to delete")):S("",!0),e(ue,{lines:"one"},{default:o(()=>[(f(!0),T(N,null,Y(l.configList,(t,u)=>(f(),k(ce,{key:u,title:t},{append:o(()=>[e(r,{icon:"mdi-minus",variant:"flat",onClick:v=>l.confirmConfigDelete(t)},null,8,["onClick"])]),_:2},1032,["title"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:l.showConfigWarningDialog,"onUpdate:modelValue":a[6]||(a[6]=t=>l.showConfigWarningDialog=t),"max-width":"750px"},{default:o(()=>[e(p,null,{default:o(()=>[e(U,{title:"Warning!",color:"#D90429"},{default:o(()=>[e(r,{icon:"mdi-close",variant:"text",onClick:a[4]||(a[4]=t=>l.showConfigWarningDialog=!1)})]),_:1}),e(P,null,{default:o(()=>[e(g,null,{default:o(()=>[i(" Are you sure you want to delete the following configuration: ")]),_:1}),e(g,{justify:"center"},{default:o(()=>[y("b",null,B(l.configToDelete),1)]),_:1})]),_:1}),e(h,null,{default:o(()=>[e(r,{onClick:a[5]||(a[5]=t=>l.deleteConfig(l.configToDelete)),color:"#64BF40",variant:"flat",block:"",loading:l.deleteLoadingBoolean},{default:o(()=>[i("I Confirm")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(fe,null,{default:o(()=>[e(V,{class:"py-0"},{default:o(()=>[e(b,null,{default:o(()=>[i("Global broker")]),_:1}),e(g,null,{default:o(()=>[e(c,{cols:"11"},{default:o(()=>[e(Z,{label:"Please choose a broker",items:l.brokerList,"item-title":"title","item-value":"url",variant:"solo-filled",modelValue:l.selectedBroker,"onUpdate:modelValue":a[7]||(a[7]=t=>l.selectedBroker=t),disabled:l.syncLoadingBoolean},null,8,["items","modelValue","disabled"])]),_:1}),e(c,{cols:"1"},{default:o(()=>[e(r,{color:"#003DA5",variant:"flat",icon:"mdi-sync",size:"large",onClick:l.syncBrokers,loading:l.syncLoadingBoolean},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1}),e(V,{class:"py-0"},{default:o(()=>[e(b,null,{default:o(()=>[i("Topics")]),_:1}),e(g,null,{default:o(()=>[e(c,{cols:"11"},{default:o(()=>[e(W,{label:"Please enter one or more topics",variant:"solo-filled",modelValue:l.topicEntry,"onUpdate:modelValue":a[8]||(a[8]=t=>l.topicEntry=t),onKeyup:de(l.addTopic,["enter"]),disabled:!l.isBrokerSelected},null,8,["modelValue","onKeyup","disabled"])]),_:1}),e(c,{cols:"1"},{default:o(()=>[e(r,{color:"#003DA5",variant:"flat",icon:"mdi-plus",size:"large",onClick:l.addTopic,disabled:!l.isBrokerSelected},null,8,["onClick","disabled"])]),_:1})]),_:1}),e(ge,null,{default:o(()=>[(f(!0),T(N,null,Y(l.topicsList,(t,u)=>(f(),k(H,{closable:"",key:u,"onClick:close":v=>l.removeTopic(u)},{default:o(()=>[i(B(t),1)]),_:2},1032,["onClick:close"]))),128))]),_:1})]),_:1}),e(V,{class:"py-4"},{default:o(()=>[e(g,{align:"center",class:"ma-1"},{default:o(()=>[e(b,null,{default:o(()=>[i("Download data")]),_:1})]),_:1}),e(g,{align:"center"},{default:o(()=>[e(c,{cols:"auto"},{default:o(()=>[e(r,{"prepend-icon":"mdi-folder-download",color:"#003DA5",variant:"flat",disabled:!l.isBrokerSelected,onClick:a[9]||(a[9]=t=>l.selectDirectory("download"))},{default:o(()=>[i("Select a folder")]),_:1},8,["disabled"])]),_:1}),e(c,{cols:"auto"},{default:o(()=>[l.downloadDirectory?(f(),k(H,{key:0,label:""},{default:o(()=>[i(B(l.truncatedDirectory),1)]),_:1})):S("",!0)]),_:1})]),_:1})]),_:1}),e(V,null,{default:o(()=>[y("div",Ge,[e(r,{onClick:a[10]||(a[10]=t=>l.showSaveDialog=!0),disabled:!l.canSubscribe,color:"#64BF40",variant:"flat",class:"ma-1",block:""},{default:o(()=>[i(" Save Configuration")]),_:1},8,["disabled"])]),y("div",Ke,[l.subscribePressed?S("",!0):(f(),k(r,{key:0,disabled:!l.canSubscribe,onClick:l.toggleSubscription,color:"#003DA5",variant:"flat",class:"ma-1",block:""},{default:o(()=>[i("Subscribe")]),_:1},8,["disabled","onClick"])),l.subscribePressed?(f(),k(r,{key:1,onClick:l.toggleSubscription,color:"#E09D00",variant:"flat",class:"ma-1",block:""},{default:o(()=>[i("Cancel Subscription")]),_:1},8,["onClick"])):S("",!0)]),y("div",Oe,[l.subscribePressed?(f(),k(r,{key:0,onClick:a[11]||(a[11]=t=>l.showTopicDialog=!0),color:"#00A9CE",variant:"flat",class:"ma-1",block:""},{default:o(()=>[i("Add or Delete Topics")]),_:1})):S("",!0)])]),_:1})]),_:1}),e(D,{modelValue:l.showSaveDialog,"onUpdate:modelValue":a[15]||(a[15]=t=>l.showSaveDialog=t),"max-width":"750px"},{default:o(()=>[e(p,null,{default:o(()=>[e(b,null,{default:o(()=>[i(" Please enter a name for your configuration "),e(r,{icon:"mdi-close",variant:"text",class:"close-button",onClick:a[12]||(a[12]=t=>l.showSaveDialog=!1)})]),_:1}),e(W,{modelValue:l.configName,"onUpdate:modelValue":a[13]||(a[13]=t=>l.configName=t),label:"Configuration Name"},null,8,["modelValue"]),e(h,null,{default:o(()=>[e(c,{cols:"6"},{default:o(()=>[e(r,{onClick:l.saveConfiguration,color:"#64BF40",variant:"flat",block:""},{default:o(()=>[i("Save")]),_:1},8,["onClick"])]),_:1}),e(c,{cols:"6"},{default:o(()=>[e(r,{onClick:a[14]||(a[14]=t=>l.selectDirectory("save")),color:"#E09D00",variant:"flat",block:""},{default:o(()=>[i("Save As")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:l.showTopicDialog,"onUpdate:modelValue":a[18]||(a[18]=t=>l.showTopicDialog=t),"max-width":"750px"},{default:o(()=>[e(p,null,{default:o(()=>[e(U,{title:"Current Topics Subscribed To",color:"#00A9CE"},{default:o(()=>[e(r,{icon:"mdi-close",variant:"text",onClick:a[16]||(a[16]=t=>l.showTopicDialog=!1)})]),_:1}),e(ue,{lines:"one"},{default:o(()=>[(f(!0),T(N,null,Y(l.topicsList,(t,u)=>(f(),k(ce,{key:u,title:t},{append:o(()=>[e(r,{icon:"mdi-minus",variant:"flat",onClick:v=>l.confirmTopicDelete(t)},null,8,["onClick"])]),_:2},1032,["title"]))),128))]),_:1}),e(h,null,{default:o(()=>[e(r,{color:"#64BF40",variant:"flat",block:"",onClick:a[17]||(a[17]=t=>l.showAddTopicDialog=!0)},{default:o(()=>[i("Add A New Topic To Subscription")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:l.showTopicWarningDialog,"onUpdate:modelValue":a[21]||(a[21]=t=>l.showTopicWarningDialog=t),"max-width":"750px"},{default:o(()=>[e(p,null,{default:o(()=>[e(U,{title:"Warning!",color:"#D90429"},{default:o(()=>[e(r,{icon:"mdi-close",variant:"text",onClick:a[19]||(a[19]=t=>l.showTopicWarningDialog=!1)})]),_:1}),e(P,null,{default:o(()=>[e(g,null,{default:o(()=>[i(" Are you sure you want to delete the following topic: ")]),_:1}),e(g,{justify:"center"},{default:o(()=>[y("b",null,B(l.topicToDelete),1)]),_:1}),e(g,null,{default:o(()=>[i(" from your subscription? ")]),_:1})]),_:1}),e(h,null,{default:o(()=>[e(r,{onClick:a[20]||(a[20]=t=>l.manageTopics(l.topicToDelete,"delete")),color:"#64BF40",variant:"flat",block:""},{default:o(()=>[i("I Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:l.showAddTopicDialog,"onUpdate:modelValue":a[26]||(a[26]=t=>l.showAddTopicDialog=t),"max-width":"750px"},{default:o(()=>[e(p,null,{default:o(()=>[e(b,null,{default:o(()=>[i(" Add A New Topic "),e(r,{icon:"mdi-close",variant:"text",class:"close-button",onClick:a[22]||(a[22]=t=>l.showAddTopicDialog=!1)})]),_:1}),e(P,null,{default:o(()=>[e(W,{label:"Please enter a new topic",variant:"solo-filled",modelValue:l.topicToAdd,"onUpdate:modelValue":a[23]||(a[23]=t=>l.topicToAdd=t),onKeyup:a[24]||(a[24]=de(t=>l.manageTopics(l.topicToAdd,"add"),["enter"]))},null,8,["modelValue"])]),_:1}),e(h,null,{default:o(()=>[e(r,{onClick:a[25]||(a[25]=t=>l.manageTopics(l.topicToAdd,"add")),color:"#64BF40",variant:"flat",block:""},{default:o(()=>[i("Add Topic")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{class:"justify-center"},{default:o(()=>[e(c,{cols:"12",class:"max-form-width"},{default:o(()=>[e(p,null,{default:o(()=>[e(b,{class:"big-title"},{default:o(()=>[i(" Notifications ")]),_:1}),e(V,null,{default:o(()=>[e(p,{variant:"tonal"},{default:o(()=>[e($e,{class:"backend-output"},{default:o(()=>[i(B(l.backendOutput)+" ",1),y("div",qe,null,512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64)}const Qe=he(je,[["render",ze],["__scopeId","data-v-10e519f5"]]);export{Qe as default};
