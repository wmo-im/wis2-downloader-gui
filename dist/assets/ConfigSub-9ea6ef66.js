import{_ as he,Q as Pe,R as f,X as S,k as e,T as o,G as N,V as d,r,c as Q,U as Ie,O as X,a2 as Le,J as i,$ as U,Z as B,Y,W as D,M as h,a3 as de,S as C,a4 as $e,a5 as Ee}from"./index-85a6329e.js";import{m as Ne,b as g,c as v,d as b,e as I,f as A,g as fe,h as Ue,V as Z,i as W,n as ge,o as H,a as We,j as c,k as V,p as ue,l as P,q as ce}from"./VRow-bf028b89.js";const Fe=Ne("v-spacer","div","VSpacer");const je=Pe({name:"ConfigSub",components:{VCard:v,VCardTitle:b,VCardText:I,VCardItem:A,VForm:fe,VBtn:d,VListGroup:Ue,VSelect:Z,VTextField:W,VChipGroup:ge,VChip:H,VCheckboxBtn:We},setup(){const l=r(!1),t=r(!1),F=r([]),L=r(!1),p=r(""),T=r(""),a=r([]),u=r(""),m=r(!1),w=r(""),j=r(null),$=r(null),E=r([]),G=r(!1),_=r(""),R=r(""),O=r(""),K=r(!1),ve=r(!1),x=r(!1),pe=r(""),q=r(!1),ee=r(""),oe=Q(()=>p.value!==""),me=Q(()=>oe.value&&a.value.length>0&&u.value!==""),we=Q(()=>u.value.length>30?"..."+u.value.slice(-30):u.value),be=async()=>{try{const n=await window.electronAPI.loadSettings();n&&(p.value=n.broker,a.value=n.topics,u.value=n.downloadDirectory,m.value=n.subscribeStatus)}catch(n){console.error("Error loading settings: ",n)}},le=async()=>{try{const n=await window.electronAPI.loadConfigNames();E.value=n}catch(n){console.error("Error loading config list: ",n)}},ke=n=>{O.value=n,K.value=!0},Ce=async()=>{try{t.value=!0,await window.electronAPI.deleteConfig(O.value),setTimeout(()=>{le(),K.value=!1,t.value=!1},1e3)}catch(n){console.error("Error deleting configurations: ",n)}},z=async()=>{try{const n=await window.electronAPI.loadBrokers();F.value=n}catch(n){console.error("Error loading brokers: ",n)}},ye=async()=>{try{L.value=!0;const s=await fetch("https://api.weather.gc.ca/collections/wis2-discovery-metadata/items");if(!s.ok)throw new Error("Failed to query catalogue");const se=(await s.json()).features[0];if(se){const re=[];let M="",J="";se.links.forEach(y=>{y.rel==="items"&&y.href.startsWith("mqtt")&&y.channel.startsWith("cache")&&(M=y.href.split("@")[1].split(":")[0],y.title?J=y.title.split("Notifications from ")[1]:J=M,re.push({title:J,url:M}))}),window.electronAPI.writeBrokers(re)}setTimeout(()=>{z(),L.value=!1},1e3)}catch(n){console.error("Error syncing brokers: ",n)}},De=()=>{T.value.trim()!==""&&(a.value.push(T.value),T.value="")},Ve=n=>{const s=a.value.indexOf(n);if(s>-1){let k=[...a.value];k.splice(s,1),a.value=k}},Ae=async n=>{try{const s=await window.electronAPI.openDialog();s&&(n=="download"?u.value=s:n=="save"&&(R.value=s,ae(),G.value=!1))}catch(s){console.error("Error selecting directory:",s)}},ae=()=>{try{const n={name:_.value,directory:R.value},s={broker:p.value,topics:Array.from(a.value),download_directory:u.value};window.electronAPI.saveConfig(n,s),E.value.includes(n.name)||E.value.push(n.name),G.value=!1}catch(n){console.error("Error saving config: ",n)}},Te=()=>{m.value=!m.value;try{const n={broker:p.value,topics:Array.from(a.value),downloadDirectory:u.value,shouldSubscribe:m.value};console.log("Data sent to backend: ",n),window.electronAPI.handleSubscription(n)}catch(n){console.error("Error subscribing: ",n),w.value="Error occurred with backend subscriber"}},te=(n,s)=>{console.log("Backend response:",s),w.value+=`
`+s.status+`
`},ne=(n,s)=>{w.value+=`
`+s+`
`},ie=(n,s)=>{w.value+=`
`+s+`
`},Se=n=>{ee.value=n,q.value=!0},Be=async(n,s)=>{if(s==="add"){a.value.push(n);const k={topic:n,action:"add"};await window.electronAPI.manageTopics(k),x.value=!1}else if(s==="delete"){t.value=!0,a.value.splice(a.value.indexOf(n),1);const k={topic:n,action:"delete"};await window.electronAPI.manageTopics(k),q.value=!1,t.value=!1}};return Ie(()=>{be(),le(),z(),window.electronAPI.onSubscriptionResponse(te),window.electronAPI.onBackendStdout(ne),window.electronAPI.onBackendStderr(ie)}),X($,async()=>{if($.value){const n=await window.electronAPI.loadConfig($.value);console.log("Config data obtained: ",n),p.value=n.broker,a.value=n.topics,u.value=n.download_directory}}),X([p,a,u,m],()=>{const n={broker:p.value,topics:Array.from(a.value),downloadDirectory:u.value,subscribeStatus:m.value};console.log("Storing settings:",n),window.electronAPI.storeSettings(n)},{deep:!0}),X(w,()=>{Ee(()=>{j.value&&j.value.scrollIntoView(),w.value=w.value.trim()})}),Le(()=>{window.electronAPI.removeListener("subscription-response",te),window.electronAPI.removeListener("backend-stdout",ne),window.electronAPI.removeListener("backend-stderr",ie)}),{brokerList:F,syncLoadingBoolean:L,selectedBroker:p,topicEntry:T,topicsList:a,downloadDirectory:u,isBrokerSelected:oe,canSubscribe:me,truncatedDirectory:we,addTopic:De,removeTopic:Ve,selectDirectory:Ae,subscribePressed:m,backendOutput:w,latestResponse:j,toggleSubscription:Te,selectedConfig:$,configList:E,configDialog:l,showSaveDialog:G,saveConfiguration:ae,configName:_,configDirectory:R,loadBrokers:z,syncBrokers:ye,configToDelete:O,deleteConfig:Ce,showConfigWarningDialog:K,confirmConfigDelete:ke,deleteLoadingBoolean:t,showTopicDialog:ve,showAddTopicDialog:x,topicToAdd:pe,manageTopics:Be,showTopicWarningDialog:q,topicToDelete:ee,confirmTopicDelete:Se}}}),Ge={key:0},Re={class:"d-flex justify-center"},Oe={class:"d-flex justify-center"},Ke={class:"d-flex justify-center"},qe={ref:"latestResponse"};function ze(l,t,F,L,p,T){return f(),S(N,null,[e(g,{class:"justify-center"},{default:o(()=>[e(c,{cols:"12",class:"max-form-width"},{default:o(()=>[e(v,null,{default:o(()=>[e(g,{dense:""},{default:o(()=>[e(c,{cols:"auto"},{default:o(()=>[e(b,{class:"big-title"},{default:o(()=>[i("WIS2 Subscription Configuration")]),_:1})]),_:1}),e(Fe),e(c,{cols:"4"},{default:o(()=>[e(Z,{label:"Configurations",density:"comfortable",variant:"solo-filled",class:"mx-3",items:l.configList,modelValue:l.selectedConfig,"onUpdate:modelValue":t[0]||(t[0]=a=>l.selectedConfig=a)},null,8,["items","modelValue"])]),_:1}),e(c,{cols:"1"},{default:o(()=>[e(d,{color:"#003DA5",variant:"flat",icon:"mdi-delete",class:"mx-1",onClick:t[1]||(t[1]=a=>l.configDialog=!0)})]),_:1})]),_:1}),e(V,{modelValue:l.configDialog,"onUpdate:modelValue":t[3]||(t[3]=a=>l.configDialog=a),"max-width":"300px"},{default:o(()=>[e(v,null,{default:o(()=>[e(U,{title:"Delete Configurations",color:"#003DA5"},{default:o(()=>[e(d,{icon:"mdi-close",variant:"text",onClick:t[2]||(t[2]=a=>l.configDialog=!1)})]),_:1}),e(I,null,{default:o(()=>[l.configList.length===0?(f(),S("div",Ge,"No configurations to delete")):B("",!0),e(ue,{lines:"one"},{default:o(()=>[(f(!0),S(N,null,Y(l.configList,(a,u)=>(f(),C(ce,{key:u,title:a},{append:o(()=>[e(d,{icon:"mdi-minus",variant:"flat",onClick:m=>l.confirmConfigDelete(a)},null,8,["onClick"])]),_:2},1032,["title"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(V,{modelValue:l.showConfigWarningDialog,"onUpdate:modelValue":t[6]||(t[6]=a=>l.showConfigWarningDialog=a),"max-width":"750px"},{default:o(()=>[e(v,null,{default:o(()=>[e(U,{title:"Warning!",color:"#D90429"},{default:o(()=>[e(d,{icon:"mdi-close",variant:"text",onClick:t[4]||(t[4]=a=>l.showConfigWarningDialog=!1)})]),_:1}),e(I,null,{default:o(()=>[e(g,null,{default:o(()=>[i(" Are you sure you want to delete the following configuration: ")]),_:1}),e(g,{justify:"center"},{default:o(()=>[D("b",null,h(l.configToDelete),1)]),_:1})]),_:1}),e(P,null,{default:o(()=>[e(d,{onClick:t[5]||(t[5]=a=>l.deleteConfig(l.configToDelete)),color:"#64BF40",variant:"flat",block:"",loading:l.deleteLoadingBoolean},{default:o(()=>[i("I Confirm")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(fe,null,{default:o(()=>[e(A,{class:"py-0"},{default:o(()=>[e(b,null,{default:o(()=>[i("Global broker")]),_:1}),e(g,null,{default:o(()=>[e(c,{cols:"11"},{default:o(()=>[e(Z,{label:"Please choose a broker",items:l.brokerList,"item-title":"title","item-value":"url",variant:"solo-filled",modelValue:l.selectedBroker,"onUpdate:modelValue":t[7]||(t[7]=a=>l.selectedBroker=a),disabled:l.syncLoadingBoolean},null,8,["items","modelValue","disabled"])]),_:1}),e(c,{cols:"1"},{default:o(()=>[e(d,{color:"#003DA5",variant:"flat",icon:"mdi-sync",size:"large",onClick:l.syncBrokers,loading:l.syncLoadingBoolean},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1}),e(A,{class:"py-0"},{default:o(()=>[e(b,null,{default:o(()=>[i("Topics")]),_:1}),e(g,null,{default:o(()=>[e(c,{cols:"11"},{default:o(()=>[e(W,{label:"Please enter one or more topics",variant:"solo-filled",modelValue:l.topicEntry,"onUpdate:modelValue":t[8]||(t[8]=a=>l.topicEntry=a),onKeyup:de(l.addTopic,["enter"]),disabled:!l.isBrokerSelected},null,8,["modelValue","onKeyup","disabled"])]),_:1}),e(c,{cols:"1"},{default:o(()=>[e(d,{color:"#003DA5",variant:"flat",icon:"mdi-plus",size:"large",onClick:l.addTopic,disabled:!l.isBrokerSelected},null,8,["onClick","disabled"])]),_:1})]),_:1}),e(ge,null,{default:o(()=>[(f(!0),S(N,null,Y(l.topicsList,a=>(f(),C(H,{key:a,closable:"",label:"","onClick:close":u=>l.removeTopic(a)},{default:o(()=>[i(h(a),1)]),_:2},1032,["onClick:close"]))),128))]),_:1})]),_:1}),e(A,{class:"py-4"},{default:o(()=>[e(g,{align:"center",class:"ma-1"},{default:o(()=>[e(b,null,{default:o(()=>[i("Download data")]),_:1})]),_:1}),e(g,{align:"center"},{default:o(()=>[e(c,{cols:"auto"},{default:o(()=>[e(d,{"prepend-icon":"mdi-folder-download",color:"#003DA5",variant:"flat",disabled:!l.isBrokerSelected,onClick:t[9]||(t[9]=a=>l.selectDirectory("download"))},{default:o(()=>[i("Select a folder")]),_:1},8,["disabled"])]),_:1}),e(c,{cols:"auto"},{default:o(()=>[l.downloadDirectory?(f(),C(H,{key:0,label:""},{default:o(()=>[i(h(l.truncatedDirectory),1)]),_:1})):B("",!0)]),_:1})]),_:1})]),_:1}),e(A,null,{default:o(()=>[D("div",Re,[e(d,{onClick:t[10]||(t[10]=a=>l.showSaveDialog=!0),disabled:!l.canSubscribe,color:"#64BF40",variant:"flat",class:"ma-1",block:""},{default:o(()=>[i(" Save Configuration")]),_:1},8,["disabled"])]),D("div",Oe,[l.subscribePressed?B("",!0):(f(),C(d,{key:0,disabled:!l.canSubscribe,onClick:l.toggleSubscription,color:"#003DA5",variant:"flat",class:"ma-1",block:""},{default:o(()=>[i("Subscribe")]),_:1},8,["disabled","onClick"])),l.subscribePressed?(f(),C(d,{key:1,onClick:l.toggleSubscription,color:"#E09D00",variant:"flat",class:"ma-1",block:""},{default:o(()=>[i("Cancel Subscription")]),_:1},8,["onClick"])):B("",!0)]),D("div",Ke,[l.subscribePressed?(f(),C(d,{key:0,onClick:t[11]||(t[11]=a=>l.showTopicDialog=!0),color:"#00A9CE",variant:"flat",class:"ma-1",block:""},{default:o(()=>[i("Add or Delete Topics")]),_:1})):B("",!0)])]),_:1})]),_:1}),e(V,{modelValue:l.showSaveDialog,"onUpdate:modelValue":t[15]||(t[15]=a=>l.showSaveDialog=a),"max-width":"750px"},{default:o(()=>[e(v,null,{default:o(()=>[e(b,null,{default:o(()=>[i(" Please enter a name for your configuration "),e(d,{icon:"mdi-close",variant:"text",class:"close-button",onClick:t[12]||(t[12]=a=>l.showSaveDialog=!1)})]),_:1}),e(W,{modelValue:l.configName,"onUpdate:modelValue":t[13]||(t[13]=a=>l.configName=a),label:"Configuration Name"},null,8,["modelValue"]),e(P,null,{default:o(()=>[e(c,{cols:"6"},{default:o(()=>[e(d,{onClick:l.saveConfiguration,color:"#64BF40",variant:"flat",block:""},{default:o(()=>[i("Save")]),_:1},8,["onClick"])]),_:1}),e(c,{cols:"6"},{default:o(()=>[e(d,{onClick:t[14]||(t[14]=a=>l.selectDirectory("save")),color:"#E09D00",variant:"flat",block:""},{default:o(()=>[i("Save As")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(V,{modelValue:l.showTopicDialog,"onUpdate:modelValue":t[18]||(t[18]=a=>l.showTopicDialog=a),"max-width":"750px"},{default:o(()=>[e(v,null,{default:o(()=>[e(U,{title:"Current Topics Subscribed To",color:"#00A9CE"},{default:o(()=>[e(d,{icon:"mdi-close",variant:"text",onClick:t[16]||(t[16]=a=>l.showTopicDialog=!1)})]),_:1}),e(ue,{lines:"one"},{default:o(()=>[(f(!0),S(N,null,Y(l.topicsList,(a,u)=>(f(),C(ce,{key:u,title:a},{append:o(()=>[e(d,{icon:"mdi-minus",variant:"flat",onClick:m=>l.confirmTopicDelete(a)},null,8,["onClick"])]),_:2},1032,["title"]))),128))]),_:1}),e(P,null,{default:o(()=>[e(d,{color:"#64BF40",variant:"flat",block:"",onClick:t[17]||(t[17]=a=>l.showAddTopicDialog=!0)},{default:o(()=>[i("Add A New Topic To Subscription")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(V,{modelValue:l.showTopicWarningDialog,"onUpdate:modelValue":t[21]||(t[21]=a=>l.showTopicWarningDialog=a),"max-width":"750px"},{default:o(()=>[e(v,null,{default:o(()=>[e(U,{title:"Warning!",color:"#D90429"},{default:o(()=>[e(d,{icon:"mdi-close",variant:"text",onClick:t[19]||(t[19]=a=>l.showTopicWarningDialog=!1)})]),_:1}),e(I,null,{default:o(()=>[e(g,null,{default:o(()=>[i(" Are you sure you want to delete the following topic: ")]),_:1}),e(g,{justify:"center"},{default:o(()=>[D("b",null,h(l.topicToDelete),1)]),_:1}),e(g,null,{default:o(()=>[i(" from your subscription? ")]),_:1})]),_:1}),e(P,null,{default:o(()=>[e(d,{onClick:t[20]||(t[20]=a=>l.manageTopics(l.topicToDelete,"delete")),color:"#64BF40",variant:"flat",block:""},{default:o(()=>[i("I Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(V,{modelValue:l.showAddTopicDialog,"onUpdate:modelValue":t[26]||(t[26]=a=>l.showAddTopicDialog=a),"max-width":"750px"},{default:o(()=>[e(v,null,{default:o(()=>[e(b,null,{default:o(()=>[i(" Add A New Topic "),e(d,{icon:"mdi-close",variant:"text",class:"close-button",onClick:t[22]||(t[22]=a=>l.showAddTopicDialog=!1)})]),_:1}),e(I,null,{default:o(()=>[e(W,{label:"Please enter a new topic",variant:"solo-filled",modelValue:l.topicToAdd,"onUpdate:modelValue":t[23]||(t[23]=a=>l.topicToAdd=a),onKeyup:t[24]||(t[24]=de(a=>l.manageTopics(l.topicToAdd,"add"),["enter"]))},null,8,["modelValue"])]),_:1}),e(P,null,{default:o(()=>[e(d,{onClick:t[25]||(t[25]=a=>l.manageTopics(l.topicToAdd,"add")),color:"#64BF40",variant:"flat",block:""},{default:o(()=>[i("Add Topic")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{class:"justify-center"},{default:o(()=>[e(c,{cols:"12",class:"max-form-width"},{default:o(()=>[e(v,null,{default:o(()=>[e(b,{class:"big-title"},{default:o(()=>[i(" Notifications ")]),_:1}),e(A,null,{default:o(()=>[e(v,{variant:"tonal"},{default:o(()=>[e($e,{class:"backend-output"},{default:o(()=>[i(h(l.backendOutput)+" ",1),D("div",qe,null,512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64)}const Qe=he(je,[["render",ze],["__scopeId","data-v-564f9ee9"]]);export{Qe as default};
